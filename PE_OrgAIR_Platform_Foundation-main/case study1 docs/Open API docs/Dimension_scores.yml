openapi: 3.0.0
info:
  title: Dimension Scores API
  version: 1.0.0
  description: API for managing dimension scores in assessments.

servers:
  - url: /api/v1

components:
  schemas:
    DimensionScore:
      type: object
      properties:
        id:
          type: integer
          example: 1
        assessmentId:
          type: integer
          example: 1
        dimension:
          type: string
          example: "risk_tolerance"
        score:
          type: number
          format: float
          example: 85.5
        confidence:
          type: number
          format: float
          example: 0.92

    DimensionScoreRequest:
      type: object
      required:
        - dimension
        - score
        - confidence
      properties:
        dimension:
          type: string
          example: "risk_tolerance"
        score:
          type: number
          format: float
          example: 85.5
        confidence:
          type: number
          format: float
          example: 0.92

    DimensionScoreUpdate:
      type: object
      properties:
        dimension:
          type: string
          example: "risk_tolerance"
        score:
          type: number
          format: float
          example: 90.0
        confidence:
          type: number
          format: float
          example: 0.95

    Error400:
      type: object
      properties:
        error:
          type: string
          example: "Bad Request"
        message:
          type: string
          example: "Invalid score data provided"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"


    Error403:
      type: object
      properties:
        error:
          type: string
          example: "Forbidden"
        message:
          type: string
          example: "Insufficient permissions to perform this action"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    Error404:
      type: object
      properties:
        error:
          type: string
          example: "Not Found"
        message:
          type: string
          example: "Resource not found"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    Error409:
      type: object
      properties:
        error:
          type: string
          example: "Conflict"
        message:
          type: string
          example: "Resource conflict detected"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    Error422:
      type: object
      properties:
        error:
          type: string
          example: "Unprocessable Entity"
        message:
          type: string
          example: "Validation failed for the provided data"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

    Error500:
      type: object
      properties:
        error:
          type: string
          example: "Internal Server Error"
        message:
          type: string
          example: "An unexpected error occurred on the server"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"

paths:
  /assessments/{id}/scores:
    post:
      tags:
        - Dimension Scores
      summary: Add dimension scores
      description: Adds dimension scores to a specific assessment.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Assessment ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DimensionScoreRequest'
      responses:
        '201':
          description: Dimension score created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DimensionScore'
              example:
                id: 1
                assessmentId: 1
                dimension: "risk_tolerance"
                score: 85.5
                confidence: 0.92
        '400':
          description: Invalid score data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400'
              example:
                error: "Bad Request"
                message: "Invalid score data provided"
                timestamp: "2024-01-15T10:30:00Z"
        
        '404':
          description: Assessment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error404'
              example:
                error: "Not Found"
                message: "Assessment with the specified ID not found"
                timestamp: "2024-01-15T10:30:00Z"
        '409':
          description: Conflict - Score already exists for this dimension
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error409'
              example:
                error: "Conflict"
                message: "A score already exists for this dimension in the assessment"
                timestamp: "2024-01-15T10:30:00Z"
        '422':
          description: Validation Error - Invalid score value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error422'
              example:
                error: "Unprocessable Entity"
                message: "Score value must be between 0 and 100"
                timestamp: "2024-01-15T10:30:00Z"
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error500'
              example:
                error: "Internal Server Error"
                message: "Failed to add dimension score due to server error"
                timestamp: "2024-01-15T10:30:00Z"

    get:
      tags:
        - Dimension Scores
      summary: Get all dimension scores
      description: Retrieves all dimension scores for a specific assessment.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Assessment ID
      responses:
        '200':
          description: Dimension scores retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DimensionScore'
              example:
                - id: 1
                  assessmentId: 1
                  dimension: "risk_tolerance"
                  score: 85.5
                  confidence: 0.92
                - id: 2
                  assessmentId: 1
                  dimension: "data_infrastructure"
                  score: 72.0
                  confidence: 0.88
        '404':
          description: Assessment not found or no scores available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error404'
              example:
                error: "Not Found"
                message: "Assessment not found or no dimension scores available"
                timestamp: "2024-01-15T10:30:00Z"
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error500'
              example:
                error: "Internal Server Error"
                message: "Failed to retrieve dimension scores due to server error"
                timestamp: "2024-01-15T10:30:00Z"

  /scores/{id}:
    put:
      tags:
        - Dimension Scores
      summary: Update a dimension score
      description: Updates an existing dimension score by its ID.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: Dimension Score ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DimensionScoreUpdate'
      responses:
        '200':
          description: Dimension score updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DimensionScore'
              example:
                id: 1
                assessmentId: 1
                dimension: "risk_tolerance"
                score: 90.0
                confidence: 0.95
        '400':
          description: Invalid update data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error400'
              example:
                error: "Bad Request"
                message: "Invalid update data provided"
                timestamp: "2024-01-15T10:30:00Z"
        '404':
          description: Score not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error404'
              example:
                error: "Not Found"
                message: "Dimension score with the specified ID not found"
                timestamp: "2024-01-15T10:30:00Z"
        '422':
          description: Validation Error - Invalid score value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error422'
              example:
                error: "Unprocessable Entity"
                message: "Score value must be between 0 and 100"
                timestamp: "2024-01-15T10:30:00Z"
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error500'
              example:
                error: "Internal Server Error"
                message: "Failed to update dimension score due to server error"
                timestamp: "2024-01-15T10:30:00Z"